# ============================================
# tmux 設定檔
# ============================================

# --------------------------------------------
# 前綴鍵設定
# --------------------------------------------
# 解除預設的 Ctrl-b
unbind C-b
# 改用 Ctrl-a（與 screen 相同習慣）
set -g prefix C-a
# 按兩次 Ctrl-a 可送出 Ctrl-a 給應用程式
bind C-a send-prefix

# --------------------------------------------
# 編號設定
# --------------------------------------------
# 視窗編號從 1 開始（0 在鍵盤左上角太遠）
set -g base-index 1
# 面板編號也從 1 開始
setw -g pane-base-index 1
# 關閉視窗時自動重新編號
set -g renumber-windows on

# --------------------------------------------
# 分割視窗
# --------------------------------------------
# | 水平分割（左右）
bind | split-window -h -c "#{pane_current_path}"
# - 垂直分割（上下）
bind - split-window -v -c "#{pane_current_path}"
# 新視窗也保持在當前目錄
bind c new-window -c "#{pane_current_path}"

# --------------------------------------------
# 面板切換（vim 風格 hjkl）
# --------------------------------------------
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# --------------------------------------------
# 調整面板大小（大寫 HJKL，可重複按）
# --------------------------------------------
# -r 表示可在 500ms 內重複按，不需再按前綴鍵
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# --------------------------------------------
# 滑鼠支援
# --------------------------------------------
# 可用滑鼠點選面板、調整大小、捲動歷史
set -g mouse on

# --------------------------------------------
# 複製模式
# --------------------------------------------
# 使用 vi 風格的按鍵操作
setw -g mode-keys vi
# v 開始選取，y 複製（類似 vim）
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# --------------------------------------------
# 效能與體驗
# --------------------------------------------
# 加快 ESC 反應時間（對 vim/neovim 使用者很重要）
set -sg escape-time 10
# 增加歷史記錄行數（預設 2000）
set -g history-limit 50000
# 訊息顯示時間（毫秒）
set -g display-time 2000
# 讓 vim/neovim 正確接收 FocusGained/FocusLost 事件
set -g focus-events on

# --------------------------------------------
# 終端相容性
# --------------------------------------------
# 256 色支援
set -g default-terminal "tmux-256color"
# True color 支援（萬用匹配所有 256color 終端）
set -ag terminal-overrides ",*-256color:RGB"

# --------------------------------------------
# 快捷操作
# --------------------------------------------
# r 重新載入設定檔
bind r source-file ~/.tmux.conf \; display "設定已重新載入！"
# x 關閉面板時不需確認
bind x kill-pane
# X 關閉視窗前確認（防止誤按）
bind X confirm-before -p "關閉視窗？(y/n)" kill-window

# --------------------------------------------
# 狀態列
# --------------------------------------------
# 狀態列放在底部
set -g status-position bottom
# 每 5 秒更新狀態列
set -g status-interval 5
# 狀態列背景色
set -g status-style "bg=colour235,fg=colour136"
# 當前視窗標示
setw -g window-status-current-style "bg=colour136,fg=colour235,bold"

# 只在複製模式顯示捲軸（需 tmux 3.5+ 且編譯時啟用）
set -g pane-scrollbars modal
set -g pane-scrollbars-position right

# 自訂樣式：前景色是滑塊顏色，背景色是捲軸底色
set -g pane-scrollbars-style fg=colour248,bg=colour236

# 左側顯示 hostname（去除 .local）+ session name
set -g status-left "#[fg=colour39,bold]#(hostname -s) #[default][#S] "
set -g status-left-length 40

# 右側顯示日期時間
set -g status-right "#{?window_bigger,[#{window_offset_x}#,#{window_offset_y}] ,}\"#{=21:pane_title}\" %m/%d %a %H:%M"
